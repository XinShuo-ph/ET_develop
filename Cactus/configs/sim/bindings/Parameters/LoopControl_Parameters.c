/*@@
   @file    LoopControl_Parameters.c
   @author  Automatically generated by CreateParameterBindings.pl
   @desc
            Creates/extends parameters for this thorn
   @enddesc
 @@*/


#include <stdio.h>
#include <stdlib.h>
#include <stdarg.h>

#include "cctk_Config.h"
#include "cctk_Constants.h"
#include "ParameterBindings.h"
#include "CParameterStructNames.h"
#include "ParameterCRestrictedIO.h"

/* structure containing all private parameters of thorn LoopControl */
struct
{
  CCTK_REAL random_jump_probability;
  CCTK_REAL statistics_every_seconds;
  CCTK_REAL very_expensive_factor;
  const char * initial_setup;
  const char * statistics_filename;
  CCTK_INT align_with_cachelines;
  CCTK_INT explore_eagerly_before_iteration;
  CCTK_INT loopsize_i;
  CCTK_INT loopsize_j;
  CCTK_INT loopsize_k;
  CCTK_INT max_size_factor;
  CCTK_INT selftest;
  CCTK_INT settle_after_iteration;
  CCTK_INT tilesize_i;
  CCTK_INT tilesize_j;
  CCTK_INT tilesize_k;
  CCTK_INT tryout_iterations;
  CCTK_INT use_smt_threads;
  CCTK_INT verbose;
  CCTK_INT veryverbose;
} PRIVATE_LOOPCONTROL_STRUCT;


/* structure containing all restricted parameters of thorn LoopControl */
struct
{
  int dummy_parameter;
} RESTRICTED_LOOPCONTROL_STRUCT;


int CCTKi_BindingsCreateLoopControlParameters(void);
int CCTKi_BindingsCreateLoopControlParameters(void)
{
  CCTKi_ParameterCreate("align_with_cachelines",
                        "LoopControl",
                        "BOOLEAN",
                        "PRIVATE",
                        CCTK_STEERABLE_ALWAYS,
                        "Align innermost loops with cache line size",
                        "yes",
                        &(PRIVATE_LOOPCONTROL_STRUCT.align_with_cachelines),
                        0,
                        NULL,
                        0);

  CCTKi_ParameterCreate("explore_eagerly_before_iteration",
                        "LoopControl",
                        "INT",
                        "PRIVATE",
                        CCTK_STEERABLE_ALWAYS,
                        "Try to explore the parameter space as much as possible before this iteration",
                        "0",
                        &(PRIVATE_LOOPCONTROL_STRUCT.explore_eagerly_before_iteration),
                        0,
                        NULL,
                        1,
                        "0:*", "");

  CCTKi_ParameterCreate("initial_setup",
                        "LoopControl",
                        "KEYWORD",
                        "PRIVATE",
                        CCTK_STEERABLE_ALWAYS,
                        "Initial configuration",
                        "tiled",
                        &(PRIVATE_LOOPCONTROL_STRUCT.initial_setup),
                        0,
                        NULL,
                        2,
                        "legacy", "Like a non-LoopControl loop",
                        "tiled", "Basic LoopControl setup");

  CCTKi_ParameterCreate("loopsize_i",
                        "LoopControl",
                        "INT",
                        "PRIVATE",
                        CCTK_STEERABLE_ALWAYS,
                        "Size of each thread's loop in i direction (in grid points) for multithreading",
                        "8",
                        &(PRIVATE_LOOPCONTROL_STRUCT.loopsize_i),
                        0,
                        NULL,
                        1,
                        "1:*", "");

  CCTKi_ParameterCreate("loopsize_j",
                        "LoopControl",
                        "INT",
                        "PRIVATE",
                        CCTK_STEERABLE_ALWAYS,
                        "Size of each thread's loop in j direction (in grid points) for multithreading",
                        "8",
                        &(PRIVATE_LOOPCONTROL_STRUCT.loopsize_j),
                        0,
                        NULL,
                        1,
                        "1:*", "");

  CCTKi_ParameterCreate("loopsize_k",
                        "LoopControl",
                        "INT",
                        "PRIVATE",
                        CCTK_STEERABLE_ALWAYS,
                        "Size of each thread's loop in k direction (in grid points) for multithreading",
                        "8",
                        &(PRIVATE_LOOPCONTROL_STRUCT.loopsize_k),
                        0,
                        NULL,
                        1,
                        "1:*", "");

  CCTKi_ParameterCreate("max_size_factor",
                        "LoopControl",
                        "INT",
                        "PRIVATE",
                        CCTK_STEERABLE_ALWAYS,
                        "Maximum size for modifying loop sizes",
                        "4",
                        &(PRIVATE_LOOPCONTROL_STRUCT.max_size_factor),
                        0,
                        NULL,
                        1,
                        "1:*", "");

  CCTKi_ParameterCreate("random_jump_probability",
                        "LoopControl",
                        "REAL",
                        "PRIVATE",
                        CCTK_STEERABLE_ALWAYS,
                        "Probability of a random jump to begin exploring a very different param",
                        "0.1",
                        &(PRIVATE_LOOPCONTROL_STRUCT.random_jump_probability),
                        0,
                        NULL,
                        1,
                        "0.0:1.0", "");

  CCTKi_ParameterCreate("selftest",
                        "LoopControl",
                        "BOOLEAN",
                        "PRIVATE",
                        CCTK_STEERABLE_ALWAYS,
                        "Run a self test with every loop (expensive)",
                        "no",
                        &(PRIVATE_LOOPCONTROL_STRUCT.selftest),
                        0,
                        NULL,
                        0);

  CCTKi_ParameterCreate("settle_after_iteration",
                        "LoopControl",
                        "INT",
                        "PRIVATE",
                        CCTK_STEERABLE_ALWAYS,
                        "Do not explore the parameter space any more at or after this iteration",
                        "0",
                        &(PRIVATE_LOOPCONTROL_STRUCT.settle_after_iteration),
                        0,
                        NULL,
                        2,
                        "-1", "always continue exploring",
                        "0:*", "");

  CCTKi_ParameterCreate("statistics_every_seconds",
                        "LoopControl",
                        "REAL",
                        "PRIVATE",
                        CCTK_STEERABLE_ALWAYS,
                        "Output statistics every so many seconds",
                        "-1.0",
                        &(PRIVATE_LOOPCONTROL_STRUCT.statistics_every_seconds),
                        0,
                        NULL,
                        2,
                        "-1.0", "don't output",
                        "0.0:*", "output every so many seconds");

  CCTKi_ParameterCreate("statistics_filename",
                        "LoopControl",
                        "STRING",
                        "PRIVATE",
                        CCTK_STEERABLE_ALWAYS,
                        "File name for LoopControl statistics",
                        "LoopControl-statistics",
                        &(PRIVATE_LOOPCONTROL_STRUCT.statistics_filename),
                        0,
                        NULL,
                        2,
                        "", "disable statistics output",
                        ".+", "file name");

  CCTKi_ParameterCreate("tilesize_i",
                        "LoopControl",
                        "INT",
                        "PRIVATE",
                        CCTK_STEERABLE_ALWAYS,
                        "Tile size in i direction (in grid points) for loop tiling",
                        "4",
                        &(PRIVATE_LOOPCONTROL_STRUCT.tilesize_i),
                        0,
                        NULL,
                        1,
                        "1:*", "");

  CCTKi_ParameterCreate("tilesize_j",
                        "LoopControl",
                        "INT",
                        "PRIVATE",
                        CCTK_STEERABLE_ALWAYS,
                        "Tile size in j direction (in grid points) for loop tiling",
                        "4",
                        &(PRIVATE_LOOPCONTROL_STRUCT.tilesize_j),
                        0,
                        NULL,
                        1,
                        "1:*", "");

  CCTKi_ParameterCreate("tilesize_k",
                        "LoopControl",
                        "INT",
                        "PRIVATE",
                        CCTK_STEERABLE_ALWAYS,
                        "Tile size in k direction (in grid points) for loop tiling",
                        "4",
                        &(PRIVATE_LOOPCONTROL_STRUCT.tilesize_k),
                        0,
                        NULL,
                        1,
                        "1:*", "");

  CCTKi_ParameterCreate("tryout_iterations",
                        "LoopControl",
                        "INT",
                        "PRIVATE",
                        CCTK_STEERABLE_ALWAYS,
                        "Try out new params for this many iterations before judging them",
                        "1",
                        &(PRIVATE_LOOPCONTROL_STRUCT.tryout_iterations),
                        0,
                        NULL,
                        1,
                        "1:*", "");

  CCTKi_ParameterCreate("use_smt_threads",
                        "LoopControl",
                        "BOOLEAN",
                        "PRIVATE",
                        CCTK_STEERABLE_ALWAYS,
                        "Place SMT threads close together",
                        "yes",
                        &(PRIVATE_LOOPCONTROL_STRUCT.use_smt_threads),
                        0,
                        NULL,
                        0);

  CCTKi_ParameterCreate("verbose",
                        "LoopControl",
                        "BOOLEAN",
                        "PRIVATE",
                        CCTK_STEERABLE_ALWAYS,
                        "Output some loop information at run time",
                        "no",
                        &(PRIVATE_LOOPCONTROL_STRUCT.verbose),
                        0,
                        NULL,
                        0);

  CCTKi_ParameterCreate("very_expensive_factor",
                        "LoopControl",
                        "REAL",
                        "PRIVATE",
                        CCTK_STEERABLE_ALWAYS,
                        "Params worse than the current-best by more than this factor are ignored more quickly",
                        "1.5",
                        &(PRIVATE_LOOPCONTROL_STRUCT.very_expensive_factor),
                        0,
                        NULL,
                        1,
                        "1.0:*", "");

  CCTKi_ParameterCreate("veryverbose",
                        "LoopControl",
                        "BOOLEAN",
                        "PRIVATE",
                        CCTK_STEERABLE_ALWAYS,
                        "Output detailed debug information at run time",
                        "no",
                        &(PRIVATE_LOOPCONTROL_STRUCT.veryverbose),
                        0,
                        NULL,
                        0);

  return 0;
}

int CCTKi_BindingsLoopControlParameterExtensions(void);
int CCTKi_BindingsLoopControlParameterExtensions(void)
{
  return 0;
}

